<html>
<meta charset="UTF-8">
<title>Capacidad actual</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="css/estilos.css">
<!-- Buttons DataTables -->

<link rel="stylesheet" href="css/buttons.bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="../../../dist/Chart.min.js"></script>
<script src="utils.js"></script>
<style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;

    }

    #capacidad{
        text-align: center;
    
    }
    #grafica{

    }
</style>

<head>
    <!-- Head de interfaz de operadores -->
    <div class="row fondo">
                <div class="col-sm-12 col-md-12 col-lg-12">
            <h1 class="text-center text-uppercase">KPI</h1>
        </div>
    </div>
    <br>
    <!-- Botones para agregar registro -->
    <button class='tareas btn btn-primary' onclick='location.href="tablero.html"'><i class='fa fa-home'></i>
        Home</button>
    <br>
    <br>
</head>

<body>
    <label><h3>Seleccione un mes para consultar</h3></label>
    <select id="mes" autofocus>
        <option value="1">Enero</option>
        <option value="2">Febrero</option>
        <option value="3">Marzo</option>
        <option value="4">Abril</option>
        <option value="5">Mayo</option>
        <option value="6">Junio</option>
        <option value="7">Julio</option>
        <option value="8">Agosto</option>
        <option value="9">Septiembre</option>
        <option value="10">Octubre</option>
        <option value="11">Noviembre</option>
        <option value="12">Diciembre</option>
    </select>
    <button id="consulta">Consultar</button>
    <!--Tabla que muestra los dias y las horas trabajadas-->
    <div class="container" >
        <table border="1">
<tr>
    <td>
        <section id="capacidad" >
            <h1>Capacidad Actual</h1>
            <h1><label id="porcentaje"></label></h1>  
        </section>   
    </td>
    <td style="width: 600px; height: 300px;">
        <h4 style="text-align: center;">Produccion de piezas por turno</h4>
        <div id="canvas-holder" style="width:100%">
            <canvas id="chart-area"></canvas>
        </div>
           
        
     
    </td>
    <td style="width: 600px; height: 300px;">
        <h4 style="text-align: center;">Demoras del mes</h4>
        <div id="canvas-holder" style="width:100%">
            <canvas id="chart-area2"></canvas>
        </div>
    </td>
    </tr>
    </table>
    </div>
   
</body>
<script src="js/jquery-1.12.3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="js/dataTables.bootstrap.js"></script>
<!--botones DataTables-->
<script src="js/dataTables.buttons.min.js"></script>
<script src="js/buttons.bootstrap.min.js"></script>


<script>
$( document ).ready(function() {
    
});

//boton de consulta para cargar nuevos datos
$("#consulta").on("click",function(){
    var selectedmonth = $("#mes").children("option:selected").val();
    cargacapacidad(selectedmonth);
    piezasporturno(selectedmonth);
});


function cargacapacidad(mes){
    $.ajax({
            type: "POST",
            url: "porcentajegenteral.php",
            data: {mesconsulta:mes},
            success: function(result) {
                $("#porcentaje").text(result +"%");              
            }
        })
}

function piezasporturno(mes){
    $.ajax({
            type: "POST",
            url: "consultapiezasporturno.php",
            data: {mesconsulta:mes},
            success: function(result) {
                var obj2 = JSON.parse(result); 
                var arreglo2 = [];
                for (var i = 0; i < obj2.length; i++) {
                    arreglo2.push(obj2[i]);
                }
                console.log(arreglo2);
                config.data.datasets['0'].data = arreglo2;
                grafica();
                grafica2();
               console.log(config.data.datasets.data);
            }
        })

}


        var config = {
            type: 'pie',
            data: {
                datasets: [{
                    data: [],
                    backgroundColor: [
                        window.chartColors.orange,
                        window.chartColors.yellow,
                        window.chartColors.green,
                        window.chartColors.blue,
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    'Matutino',
                    'Vespertino'
                ]
            },
            options: {
                responsive: true
            }
        };

        var config2 = {
            type: 'pie',
            data: {
                datasets: [{
                    data: [3,4,2],
                    backgroundColor: [
                        window.chartColors.green,
                        window.chartColors.blue,
                        window.chartColors.orange,
                        window.chartColors.yellow,
                    ],
                    label: 'Dataset 1'
                }],
                labels: [
                    'Mantenimiento',
                    'Maquina descompuesta',
                    'Falla mecanica'
                ]
            },
            options: {
                responsive: true
            }
        };
        function grafica() {
            var ctx = document.getElementById('chart-area').getContext('2d');
            window.myPie = new Chart(ctx, config);
        };

        function grafica2() {
            var ctx = document.getElementById('chart-area2').getContext('2d');
            window.myPie = new Chart(ctx, config2);
        };


        var colorNames = Object.keys(window.chartColors);
     



</script>
</body>

</body>



</html>