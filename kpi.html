<html>
<meta charset="UTF-8">
<title>Capacidad actual</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="css/estilos.css">
<!-- Buttons DataTables -->

<link rel="stylesheet" href="css/buttons.bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="../../../dist/Chart.min.js"></script>
<script src="utils.js"></script>
<style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }

    #capacidad {
        text-align: center;

    }

    #grafica {}
</style>

<head>
    <!-- Head de interfaz de operadores -->
    <div class="row fondo">
        <div class="col-sm-12 col-md-12 col-lg-12">
            <h1 class="text-center text-uppercase">KPI</h1>
        </div>
    </div>
    <br>
    <!-- Botones para agregar registro -->
    <button class='tareas btn btn-primary' onclick='location.href="tablero.html"'><i class='fa fa-home'></i>
        Home</button>
    <br>
    <br>
</head>

<body>

    <!--Tabla que muestra los dias y las horas trabajadas-->
    <div class="container">
        <div>
            <label for="exampleFormControlSelect1">Seleccione un mes para consultar</label>
            <select id="mes" autofocus>
                <option value="1">Enero</option>
                <option value="2">Febrero</option>
                <option value="3">Marzo</option>
                <option value="4">Abril</option>
                <option value="5">Mayo</option>
                <option value="6">Junio</option>
                <option value="7">Julio</option>
                <option value="8">Agosto</option>
                <option value="9">Septiembre</option>
                <option value="10">Octubre</option>
                <option value="11">Noviembre</option>
                <option value="12">Diciembre</option>
            </select>
            <button id="consulta">Consultar</button>
        </div>

        <table border="1">
            <tr>
                <td>
                    <section id="capacidad">
                        <h1>Capacidad Actual</h1>
                        <h1><label id="porcentaje"></label></h1>
                    </section>
                </td>
                <td style="width: 600px; height: 400px;">
                    <h4 style="text-align: center;">Produccion de piezas por turno</h4>
                    <div id="canvas-holder" style="width:100%">
                        <canvas id="chart-area"></canvas>
                    </div>
                    <div style="text-align: center;">
                        <h3>Total: <labe id="total"></labe>
                        </h3>

                    </div>
                </td>
                <td style="width: 800px; height: 400px;">
                    <h4 style="text-align: center;">Demoras del mes</h4>
                    <label id="nohay"></label>
                    <div id="canvas-holder" style="width:100%">
                        <canvas id="chart-area2"></canvas>
                    </div>
                </td>
            </tr>

        </table>
        <table border="1">
            <tr>
                
                <td style="width: 1200px; height: 500px; text-align: center;">
                    <h4 style="text-align: center;">Produccion turno matutino</h4>
                    <div style="width:75%; text-align: center;">
                        <canvas id="canvas"></canvas>
                    </div>
                </td>
            </tr>
        </table>
        <table border="1">
            <tr>
                <td style="width: 1200px; height: 500px; text-align: center;">
                    <h4 style="text-align: center;">Produccion turno vespertino</h4>

                    <div style="width:75%; text-align: center;">
                        <canvas id="canvas2"></canvas>
                    </div>
                </td>
            </tr>
        </table>
    </div>

</body>
<script src="js/jquery-1.12.3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="js/dataTables.bootstrap.js"></script>
<!--botones DataTables-->
<script src="js/dataTables.buttons.min.js"></script>
<script src="js/buttons.bootstrap.min.js"></script>


<script>
    $(document).ready(function () {

    });

    //boton de consulta para cargar nuevos datos
    $("#consulta").on("click", function () {
        var selectedmonth = $("#mes").children("option:selected").val();
        cargacapacidad(selectedmonth);
        piezasporturno(selectedmonth);
    });

    function cargacapacidad(mes) {
        $.ajax({
            type: "POST",
            url: "porcentajegenteral.php",
            data: { mesconsulta: mes },
            success: function (result) {
                $("#porcentaje").text(result + "%");
            }
        })
    }
    function paros(mes) {
        $.ajax({
            type: "POST",
            url: "consultaparosxmes.php",
            data: { mesconsulta: mes },
            success: function (result) {
                $("#nohay").text("");
                config2.data.datasets['0'].data=[""];
                config2.data.labels=[""];
               if(result!="0"){
                var obj2 = JSON.parse(result);
                var arreglo = [];
                var comments=[];
                for(var i=0;i<obj2['data'].length;i++){
                    arreglo[i]=parseInt(obj2["data"][i].horas_paro);
                    comments[i]=obj2["data"][i].descripcion;
                }
                config2.data.datasets['0'].data=arreglo;
                config2.data.labels=comments;
                console.log(config2);
                grafica2();
               }else{
                $("#nohay").text("No hay paros ese mes");
               }
                
            }
        })
       
    }

    function piezasporturno(mes) {
        $.ajax({
            type: "POST",
            url: "consultapiezasporturno.php",
            data: { mesconsulta: mes },
            success: function (result) {
                var obj2 = JSON.parse(result);
                var arreglo2 = [];
                var tmp = 0;
                for (var i = 0; i < obj2.length; i++) {
                    arreglo2.push(obj2[i]);
                    tmp = (parseInt(tmp) + parseInt(arreglo2[i]));
                }
                $("#total").text(tmp);
                config.data.datasets['0'].data = arreglo2;
                grafica();
                graficaM(mes);
                graficav(mes);
                paros(mes);
                
                console.log(config2);
            }
        })

    }

    var config = {
        type: 'pie',
        data: {
            datasets: [{
                data: [],
                backgroundColor: [
                    window.chartColors.orange,
                    window.chartColors.yellow,
                    window.chartColors.green,
                    window.chartColors.blue,
                ],
                label: 'Dataset 1'
            }],
            labels: [
                'Matutino',
                'Vespertino'
            ]
        },
        options: {
            responsive: true
        }
    };

    var config2 = {
        type: 'pie',
        data: {
            datasets: [{
                data: [1],
                backgroundColor: [
                    window.chartColors.green,
                    window.chartColors.blue,
                    window.chartColors.orange,
                    window.chartColors.yellow,
                ],
                label: 'Dataset 1'
            }],
            labels: [""]
        },
        options: {
            responsive: true
        }
    };
    function grafica() {
        var ctx = document.getElementById('chart-area').getContext('2d');
        window.myPie = new Chart(ctx, config);
    };

    function grafica2() {
        var ctx = document.getElementById('chart-area2').getContext('2d');
        window.myPie = new Chart(ctx, config2);
    };


    var colorNames = Object.keys(window.chartColors);

    //
    function graficaM(mes){
    $.ajax({
        type: "POST",
        url: "eficacia_produccionM.php",
        data: { "mesconsulta": mes },
        success: function (result) {
           // console.log(result);
            var arreglo = daysInThisMonth();
           // console.log(arreglo);
            configuration.data.labels = arreglo;
          //  console.log(configuration.data);
           
            generadata(result);
            cargagrafico3();
        }
    })
}
    function generadata(result) {
        var obj = JSON.parse(result);
        var days = daysInThisMonth();
        var arreglo = [];
        var arreglo2 = [];
        var arreglo3 = [];
        var arreglo4 = [];
        //for para llenar arreglo de 0 
        for (var x = 1; x <= days; x++) {
            var produccion = 0;
            arreglo.push(produccion);
            arreglo2.push(produccion);
            arreglo3.push(produccion);
            arreglo4.push(produccion);
        }
        var total =Object.keys(obj).length;
        //console.log(obj);
        for (var i = 0; i < total; i++) {
            var fecha = new Date(obj[i].fecha);
            arreglo[fecha.getDate() + 1]=obj[i].productividadtotal;
            arreglo2[fecha.getDate() + 1]=obj[i].eficaciatotal;
            arreglo3[fecha.getDate() + 1]=obj[i].reprocesototal;
            arreglo4[fecha.getDate() + 1]=obj[i].scraptotal;
        }
      /*   console.log(arreglo);
        console.log(arreglo2);
        console.log(arreglo3);
        console.log(arreglo4); */
        
 console.log(configuration.data.datasets['0'].data = arreglo);
        console.log(configuration.data.datasets['1'].data = arreglo2);
        console.log(configuration.data.datasets['2'].data = arreglo3);
        console.log(configuration.data.datasets['3'].data = arreglo4); 
    }
    function graficav(mes){
    $.ajax({
        type: "POST",
        url: "eficacia_produccionV.php",
        data: { "mesconsulta": mes },
        success: function (result) {
            console.log(result);
            var arreglo = daysInThisMonth();
            console.log(arreglo);
            configuration2.data.labels = arreglo;
            console.log(configuration.data);
            generadata2(result);
            cargagrafico4();
        }
    })
}
    function generadata2(result) {
        var obj = JSON.parse(result);
        var days = daysInThisMonth();
        var arreglo = [];
        var arreglo2 = [];
        var arreglo3 = [];
        var arreglo4 = [];
        //for para llenar arreglo de 0 
        for (var x = 1; x <= days; x++) {
            var produccion = 0;
            arreglo.push(produccion);
            arreglo2.push(produccion);
            arreglo3.push(produccion);
            arreglo4.push(produccion);
        }
        var total =Object.keys(obj).length;
        console.log(obj);
        for (var i = 0; i < total; i++) {
            var fecha = new Date(obj[i].fecha);
            arreglo[fecha.getDate() + 1]=obj[i].productividadtotal;
            arreglo2[fecha.getDate() + 1]=obj[i].eficaciatotal;
            arreglo3[fecha.getDate() + 1]=obj[i].reprocesototal;
            arreglo4[fecha.getDate() + 1]=obj[i].scraptotal;
        }
      /*   console.log(arreglo);
        console.log(arreglo2);
        console.log(arreglo3);
        console.log(arreglo4); */
        
 console.log(configuration2.data.datasets['0'].data = arreglo);
        console.log(configuration2.data.datasets['1'].data = arreglo2);
        console.log(configuration2.data.datasets['2'].data = arreglo3);
        console.log(configuration2.data.datasets['3'].data = arreglo4); 
    }


    function daysInThisMonth() {
        var now = new Date();
        var days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        var day = "";
        var arreglo = [];
        for (var tmp = 0; tmp <= days; tmp++) {
            day = day + "dia " + tmp;

            if (tmp === days) {
                arreglo.push(day);
            } else {
                day = day + "";
                arreglo.push(day);
            }
            day = "";
        }
        return arreglo;
    }

    //var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    var configuration = {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Productividad ',
                backgroundColor: window.chartColors.red,
                borderColor: window.chartColors.red,
                data: [],
                fill: false,
            }, {
                label: 'Eficacia',
                fill: false,
                backgroundColor: window.chartColors.yellow,
                borderColor: window.chartColors.yellow,
                data: [],
            },{
                label: 'Reproceso',
                fill: false,
                backgroundColor: window.chartColors.blue,
                borderColor: window.chartColors.blue,
                data: [],
            },{
                label: 'Scrap',
                fill: false,
                backgroundColor: window.chartColors.green,
                borderColor: window.chartColors.green,
                data: [],
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Produccion turno matutino'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                x: {
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Month'
                    }
                },
                y: {
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Value'
                    }
                }
            }
        }
    };

    function cargagrafico3() {
        var ctx = document.getElementById('canvas').getContext('2d');
        window.myLine = new Chart(ctx, configuration);
    };

    var configuration2 = {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Productividad ',
                backgroundColor: window.chartColors.red,
                borderColor: window.chartColors.red,
                data: [],
                fill: false,
            }, {
                label: 'Eficacia',
                fill: false,
                backgroundColor: window.chartColors.yellow,
                borderColor: window.chartColors.yellow,
                data: [],
            },{
                label: 'Reproceso',
                fill: false,
                backgroundColor: window.chartColors.blue,
                borderColor: window.chartColors.blue,
                data: [],
            },{
                label: 'Scrap',
                fill: false,
                backgroundColor: window.chartColors.green,
                borderColor: window.chartColors.green,
                data: [],
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Produccion turno matutino'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                x: {
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Month'
                    }
                },
                y: {
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Value'
                    }
                }
            }
        }
    };

    function cargagrafico4() {
        var ctx = document.getElementById('canvas2').getContext('2d');
        window.myLine = new Chart(ctx, configuration2);
    };



</script>
</body>





</html>